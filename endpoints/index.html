<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Server endpoints - PatientMatcher documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Server endpoints";
        var mkdocs_page_input_path = "endpoints.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> PatientMatcher documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../docker_app/">Docker-based application</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../conda_inst/">Installing the application on a conda environment</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../data_types/">Data types</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cli/">Command line interface</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../phenotype_resources/">Phenotype resource files</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Server endpoints</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#patientadd">/patient/add</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#patientdelete">/patient/delete/</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#metrics">/metrics</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#nodes">/nodes</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#match">/match</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#matchexternal">/match/external/</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#matches">/matches/</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../algorithm/">Matching algrorithm</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../matching_emails/">Matching notifications</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../error_emails/">Server error notifications</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">PatientMatcher documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Server endpoints</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="server-endpoints">Server endpoints</h2>
<h3 id="patientadd"><strong>/patient/add</strong></h3>
<p>&nbsp;To add patients using a <strong>POST</strong> request. Example:</p>
<pre><code class="language-bash">curl -X POST \
  -H 'X-Auth-Token: DEMO' \
  -H 'Content-Type: application/vnd.ga4gh.matchmaker.v1.0+json' \
  -H 'Accept: application/json' \
  -d '{&quot;patient&quot;:{
    &quot;id&quot;:&quot;patient_id&quot;,
    &quot;contact&quot;: {&quot;name&quot;:&quot;Contact Name&quot;, &quot;href&quot;:&quot;mailto:contact_name@mail.com&quot;},
    &quot;features&quot;:[{&quot;id&quot;:&quot;HP:0009623&quot;}],
    &quot;genomicFeatures&quot;:[{&quot;gene&quot;:{&quot;id&quot;:&quot;EFTUD2&quot;}}]
  }}' localhost:9020/patient/add
</code></pre>
<p>To update the data of a patient already submitted to the server you can use the same command and add a patient with the same ID.&nbsp;</p>
<p>The action of adding or updating a patient in the server will trigger an <strong>external search of similar patients from connected nodes</strong>.&nbsp;
If there are no connected nodes in the database or you are uploading demo data no search will be performed on other nodes.</p>
<h3 id="patientdelete"><strong>/patient/delete/<patient_id></strong></h3>
<p>&nbsp;You can delete a patient from the database by sending a <strong>DELETE</strong> request with its ID to the server. Example:</p>
<pre><code class="language-bash">curl -X DELETE \
  -H 'X-Auth-Token: DEMO' \
  localhost:9020/patient/delete/patient_id
</code></pre>
<p>Please note that when a patient is deleted all its match results will be also deleted from the database. This is valid for <strong>matches where the patient was used as the query patient</strong> in searches performed on other nodes or the internal patientMatcher database (internal search).
Matching results where the removed patient is instead listed among the matching results will be not removed from the database.</p>
<p>&nbsp;&nbsp;</p>
<h3 id="metrics"><strong>/metrics</strong></h3>
<p>&nbsp;Use this endpoint to <strong>get</strong> database metrics.<br>
Stats which could be retrieved by a MME service are described <a href="https://github.com/ga4gh/mme-apis/blob/master/metrics-api.md">here</a><br>
Example:</p>
<pre><code class="language-bash">curl -X GET \
  localhost:9020/metrics
</code></pre>
<p>&nbsp;&nbsp;</p>
<h3 id="nodes"><strong>/nodes</strong></h3>
<p>&nbsp;<strong>GET</strong> the list of connected nodes. Example:</p>
<pre><code class="language-bash">curl -X GET \
  -H 'X-Auth-Token: DEMO' \
  localhost:9020/nodes
</code></pre>
<p>The response will return a list like this : [ { 'id' : node_1_id, 'description' : node1_description }, .. ] or an empty list if the server is not connected to external nodes.</p>
<p>&nbsp;&nbsp;</p>
<h3 id="match"><strong>/match</strong></h3>
<p>&nbsp;<strong>POST</strong> a request with a query patient to patientMatcher and get a response with the patients in the server which are most similar to your query. Example:</p>
<pre><code class="language-bash">curl -X POST \
  -H 'X-Auth-Token: DEMO' \
  -H 'Content-Type: application/vnd.ga4gh.matchmaker.v1.0+json' \
  -H 'Accept: application/vnd.ga4gh.matchmaker.v1.0+json' \
  -d '{&quot;patient&quot;:{
    &quot;id&quot;:&quot;patient_id&quot;,
    &quot;contact&quot;: {&quot;name&quot;:&quot;Contact Name&quot;, &quot;href&quot;:&quot;mailto:contact_name@mail.com&quot;},
    &quot;features&quot;:[{&quot;id&quot;:&quot;HP:0009623&quot;}],
    &quot;genomicFeatures&quot;:[{&quot;gene&quot;:{&quot;id&quot;:&quot;EFTUD2&quot;}}]
  }}' localhost:9020/match
</code></pre>
<p>The <strong>maximum number of patients returned by the server</strong> is a parameter which can be customized by editing the "MAX_RESULTS" field in the config.py file. Default value is 5.
Patient matches are returned in order or descending similarity with the query patient (The most similar patients are higher in the list of results).</p>
<p>Another customizable parameter is the minimum patient score threshold for returned results (<strong>SCORE_THRESHOLD</strong> in the config file). Matches with patient score lower than this number won't be returned. Default value for this parameter is 0.</p>
<h3 id="matchexternal"><strong>/match/external/<patient_id></strong></h3>
<p>&nbsp;Trigger a search in external nodes for patients similar to the one specified by the ID. Example:</p>
<pre><code class="language-bash">curl -X POST \
  -H 'X-Auth-Token: DEMO' \
  localhost:9020/match/external/patient_id
</code></pre>
<p>It is possible to search for matching patients on a specific node. To do so specify the node id in the request args. Example:</p>
<pre><code class="language-bash">curl -X POST \
  -H 'X-Auth-Token: DEMO' \
  localhost:9020/match/external/patient_id?node=specific_node_id
</code></pre>
<p>Read <a href="#node_list">here</a> how to get a list with the ID of the connected nodes.</p>
<h3 id="matches"><strong>/matches/<patient_id></strong></h3>
<p>&nbsp;Return all matches (internal and external) with positive results for a patient specified by an ID. Example:</p>
<pre><code class="language-bash">curl -X GET \
  -H 'X-Auth-Token: DEMO' \
  localhost:9020/matches/patient_id
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../phenotype_resources/" class="btn btn-neutral float-left" title="Phenotype resource files"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../algorithm/" class="btn btn-neutral float-right" title="Matching algrorithm">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../phenotype_resources/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../algorithm/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
